<div class="container my-5">
  <div class="text-center mb-4">
    <h3 class="fw-bold">‚úàÔ∏è Add New Flight</h3>
    <p class="text-muted">Fill in the details to add a new flight</p>
  </div>

  <div class="d-flex justify-content-center">
    <form class="card shadow-lg p-4 w-100" style="max-width: 700px"
          [formGroup]="form" (ngSubmit)="register()">

      <div class="row g-3">

        <!-- Airline -->
        <div class="col-md-6">
          <label class="form-label">Airline</label>
          <select class="form-control" formControlName="airline">
            @for(airline of airlines; track airline) {
              <option [value]="airline">{{ airline }}</option>
            }
          </select>
          @if(form.get('airline')?.invalid && form.get('airline')?.touched){
            <small class="text-danger">*Airline is required</small>
          }
        </div>

        <!-- Price -->
        <div class="col-md-6">
          <label class="form-label">Price (‚Çπ)</label>
          <input class="form-control" formControlName="price" placeholder="Eg: 4500">
          @if(form.get('price')?.invalid && form.get('price')?.touched){
            @if(form.get('price')?.errors?.['required']){
              <small class="text-danger">*Price is required</small>
            }
            @if(form.get('price')?.errors?.['pattern']){
              <small class="text-danger">*Only numbers allowed</small>
            }
          }
        </div>

        <!-- Origin -->
        <div class="col-md-6">
          <label class="form-label">Origin</label>
          <input class="form-control" formControlName="origin" placeholder="Eg: Hyderabad">
          @if(form.get('origin')?.invalid && form.get('origin')?.touched){
            @if(form.get('origin')?.errors?.['required']){
              <small class="text-danger">*Origin is required</small>
            }
            @if(form.get('origin')?.errors?.['pattern']){
              <small class="text-danger">*Only alphabets allowed</small>
            }
          }
        </div>

        <!-- Destination -->
        <div class="col-md-6">
          <label class="form-label">Destination</label>
          <input class="form-control" formControlName="destination" placeholder="Eg: Delhi">
          @if(form.get('destination')?.invalid && form.get('destination')?.touched){
            @if(form.get('destination')?.errors?.['required']){
              <small class="text-danger">*Destination is required</small>
            }
            @if(form.get('destination')?.errors?.['pattern']){
              <small class="text-danger">*Only alphabets allowed</small>
            }
          }
        </div>

        <!-- Departure -->
        <div class="col-md-6">
          <label class="form-label">Departure</label>
          <div class="d-flex gap-2">
            <input type="date" class="form-control" [min]="minDate" formControlName="departureDate">
            <input type="time" class="form-control" step="300" formControlName="departureTime">
          </div>
          @if((form.get('departureDate')?.invalid && form.get('departureDate')?.touched) || (form.get('departureTime')?.invalid && form.get('departureTime')?.touched)){
            <small class="text-danger">*Departure date and time are required</small>
          }
        </div>

        <!-- Arrival -->
        <div class="col-md-6">
          <label class="form-label">Arrival</label>
          <div class="d-flex gap-2">
            <input type="date" class="form-control"
                   [min]="form.value.departureDate || minDate"
                   formControlName="arrivalDate">
            <input type="time" class="form-control" step="300" formControlName="arrivalTime">
          </div>
          @if((form.get('arrivalDate')?.invalid && form.get('arrivalDate')?.touched) || (form.get('arrivalTime')?.invalid && form.get('arrivalTime')?.touched)){
            <small class="text-danger">*Arrival date and time are required</small>
          }
        </div>

        <!-- Seats -->
        <div class="col-md-6">
          <label class="form-label">Total Seats</label>
          <input class="form-control" formControlName="totalSeats" placeholder="Eg: 180">
          @if(form.get('totalSeats')?.invalid && form.get('totalSeats')?.touched){
            <small class="text-danger">*Total seats is required</small>
          }
        </div>

      </div>

      <button class="btn btn-primary w-100 mt-4"
              [disabled]="form.invalid">
        ‚ûï Add Flight
      </button>
    </form>
  </div>
</div>
@if (flights$ | async; as flights) {

  @if (flights.length > 0) {

    <div class="container mt-5">
      <div class="row g-4">

        @for (flight of flights; track flight.flightId) {

          <div class="col-md-6">
            <div class="card shadow-sm border-0 h-100">
              <div class="card-body">

                <div class="d-flex justify-content-between align-items-center mb-2">
                  <h5 class="fw-bold">{{ flight.airline }}</h5>
                  <span class="badge bg-success fs-6">
                    {{ flight.price | currency:'INR' }}
                  </span>
                </div>

                <h6 class="text-muted mb-3">
                  {{ flight.origin }} ‚úàÔ∏è {{ flight.destination }}
                </h6>

                <div class="row small text-muted">
                  <div class="col-6">
                    <strong>Departure</strong><br>
                    {{ flight.departureTime | date:'dd MMM yyyy, hh:mm a' }}
                  </div>
                  <div class="col-6">
                    <strong>Arrival</strong><br>
                    {{ flight.arrivalTime | date:'dd MMM yyyy, hh:mm a' }}
                  </div>
                </div>

                <hr>

                <div class="d-flex justify-content-between align-items-center">
                  <span class="badge bg-info">
                    Seats: {{ flight.availableSeats }}
                  </span>

                  <button class="btn btn-outline-danger btn-sm"
                          data-bs-toggle="modal"
                          data-bs-target="#deleteModal"
                          (click)="selectedFlightId = flight.flightId">
                    üóë Delete
                  </button>
                </div>

              </div>
            </div>
          </div>

        }
      </div>
    </div>

  } @else {
    <p class="text-center text-muted mt-5">No flights found ‚úàÔ∏è</p>
  }
}
<div class="modal fade" id="deleteModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Confirm Deletion</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p>Do you really want to delete this flight?</p>
        <p class="text-muted small">This action cannot be undone.</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-danger"
                data-bs-dismiss="modal"
                (click)="confirmDelete()">
          Delete
        </button>
      </div>
    </div>
  </div>
</div>
